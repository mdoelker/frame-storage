/*! frame-storage - v1.0.1 - 2016-06-22; Copyright (c) 2016 Malte DÃ¶lker; Licensed MIT */
!function(a,b){"function"==typeof define&&define.amd?define([],b):"object"==typeof module&&module.exports?module.exports=b():a.FrameStorage=b()}(this,function(){"use strict";function a(a){var b=document.createElement("div");b.id="framestorage-"+j(),b.style.display="none",document.body.appendChild(b);var i,l,m,n,o,p,q=[],r=null,s=location.protocol+"//"+location.host,t=a.match(/^(https?:\/\/[a-z0-9-.:@]+)\/?/i)||[null,s],u=t[1];return k({root:b,url:a,width:1,height:1,onload:function(a){r=a.contentWindow,i=c.bind(null,r),l=d.bind(null,r,u),m=e.bind(null,r,u),n=f.bind(null,r,u),o=g.bind(null,r,u),p=h.bind(null,r,u),window.addEventListener("message",i,!1),q.forEach(function(a){switch(a[0]){case"save":l.apply(null,a[1]);break;case"load":m.apply(null,a[1]);break;case"empty":n.apply(null,a[1]);break;case"count":o.apply(null,a[1]);break;case"key":p.apply(null,a[1])}}),q=[]}}),{getItem:function(){m?m.apply(null,arguments):q.push(["load",arguments])},setItem:function(){l?l.apply(null,arguments):q.push(["save",arguments])},clear:function(){n?n.apply(null,arguments):q.push(["empty",arguments])},length:function(){o?o.apply(null,arguments):q.push(["count",arguments])},key:function(){p?p.apply(null,arguments):q.push(["key",arguments])},destroy:function(){b&&(document.body.removeChild(b),b=null),r&&(window.removeEventListener("message",i,!1),r=null),i=null,l=null,m=null}}}function b(a){null==a&&(a="*"),window.addEventListener("message",function(b){if("*"!==a&&b.origin!==a)return void console.error("Origin mismatch");var c=JSON.parse(b.data),d=function(d){i(b.source,{action:"frameStorageSuccess",ref:c.ref,key:c.key,value:d},a)},e=function(d){i(b.source,{action:"frameStorageError",ref:c.ref,key:c.key,message:d.message},a)};switch(c.action){case"getItem":try{var f=localStorage.getItem(c.key);d(f)}catch(g){e(g)}break;case"setItem":try{localStorage.setItem(c.key,c.value),d(null)}catch(g){e(g)}break;case"removeItem":try{localStorage.removeItem(c.key),d(null)}catch(g){e(g)}break;case"clear":try{localStorage.clear(),d()}catch(g){e(g)}break;case"length":try{d(localStorage.length)}catch(g){e(g)}break;case"key":try{var h=localStorage.key(c.value);d(h)}catch(g){e(g)}break;default:return void console.error("Unknown action")}},!1)}function c(b,c){if(c.source===b){var d=JSON.parse(c.data),e=a._callbacks[d.ref]||function(){};switch(d.action){case"frameStorageSuccess":e(null,d.value);break;case"frameStorageError":e(d.message,null);break;default:console.error("Unknown action")}delete a._callbacks[d.ref]}}function d(b,c,d,e,f){var g=j();f&&(a._callbacks[g]=f),i(b,{action:"setItem",ref:g,key:d,value:e},c)}function e(b,c,d,e){var f=j();e?a._callbacks[f]=e:console.warn("FrameStorage.getItem: Missing callback function"),i(b,{action:"getItem",ref:f,key:d},c)}function f(b,c,d){var e=j();d?a._callbacks[e]=d:console.warn("FrameStorage.clear: Missing callback function"),i(b,{action:"clear",ref:e},c)}function g(b,c,d){var e=j();d?a._callbacks[e]=d:console.warn("FrameStorage.length: Missing callback function"),i(b,{action:"length",ref:e},c)}function h(b,c,d,e){var f=j();e&&(a._callbacks[f]=e),i(b,{action:"key",ref:f,value:d},c)}function i(a,b,c){a.postMessage(JSON.stringify(b),c)}function j(){return"c"+(Math.random()*(1<<30)).toString(16).replace(".","")}function k(b){b.id=b.id||j(),b.name=b.name||j();var c=j(),d=!1,e=!1;if(a._callbacks[c]=function(){d&&!e&&(e=!0,b.onload&&b.onload(b.root.firstChild))},document.attachEvent){var f='<iframe id="'+b.id+'" name="'+b.name+'"'+(b.className?' class="'+b.className+'"':"")+' style="border:none;'+(b.width?"width:"+b.width+"px;":"")+(b.height?"height:"+b.height+"px;":"")+'" src="'+b.url+'" frameborder="0" scrolling="no" allowtransparency="true" onload="FrameStorage._callbacks.'+c+'()"></iframe>';b.root.innerHTML='<iframe src="javascript:false" frameborder="0" scrolling="no" style="height:1px"></iframe>',d=!0,window.setTimeout(function(){b.root.innerHTML=f},0)}else{var g=document.createElement("iframe");g.id=b.id,g.name=b.name,g.onload=a._callbacks[c],g.style.border="none",g.style.overflow="hidden",b.className&&(g.className=b.className),b.height&&(g.style.height=b.height+"px"),b.width&&(g.style.width=b.width+"px"),b.root.appendChild(g),d=!0,g.src=b.url}}return a.initChannel=b,a._callbacks={},a});